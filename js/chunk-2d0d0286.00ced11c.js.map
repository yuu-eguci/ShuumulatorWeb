{"version":3,"sources":["webpack:///./src/components/SignIn.vue?4066","webpack:///src/components/SignIn.vue","webpack:///./src/components/SignIn.vue?ecd4","webpack:///./src/components/SignIn.vue"],"names":["render","_vm","this","_h","$createElement","_c","_self","attrs","locked","scopedSlots","_u","key","fn","staticClass","iconAnimation","proxy","_v","_s","$t","ref","loading","on","inspectInvitationCode","model","value","callback","$$v","invitationCode","expression","staticRenderFns","name","data","methods","animateUnlock","setTimeout","pnotifyUtils","component"],"mappings":"yHAAA,IAAIA,EAAS,WAAa,IAAIC,EAAIC,KAASC,EAAGF,EAAIG,eAAmBC,EAAGJ,EAAIK,MAAMD,IAAIF,EAAG,OAAOE,EAAG,MAAM,CAACA,EAAG,QAAQ,CAACA,EAAG,QAAQ,CAACE,MAAM,CAAC,GAAK,OAAOF,EAAG,QAAQ,CAACE,MAAM,CAAC,GAAK,MAAM,CAACF,EAAG,cAAc,CAACE,MAAM,CAAC,aAAaN,EAAIO,OAAS,OAAS,UAAU,eAAe,SAASC,YAAYR,EAAIS,GAAG,CAAC,CAACC,IAAI,SAASC,GAAG,WAAW,MAAO,CAACP,EAAG,MAAM,CAACQ,YAAY,eAAe,CAAEZ,EAAU,OAAEI,EAAG,SAAS,CAACQ,YAAY,kCAAkCN,MAAM,CAAC,KAAO,OAAO,UAAYN,EAAIa,cAAc,aAAa,OAAOT,EAAG,SAAS,CAACQ,YAAY,kCAAkCN,MAAM,CAAC,KAAO,SAAS,aAAa,QAAQ,KAAKQ,OAAM,GAAM,CAACJ,IAAI,OAAOC,GAAG,WAAW,MAAO,CAACP,EAAG,SAAS,CAACJ,EAAIe,GAAG,yBAAyBf,EAAIe,GAAG,IAAIf,EAAIgB,GAAGhB,EAAIiB,GAAG,WAAW,OAAOH,OAAM,MAAS,CAACV,EAAG,IAAI,CAACA,EAAG,eAAe,CAACc,IAAI,YAAYZ,MAAM,CAAC,SAAWN,EAAImB,QAAQ,aAAe,MAAM,KAAO,MAAMC,GAAG,CAAC,MAAQpB,EAAIqB,uBAAuBC,MAAM,CAACC,MAAOvB,EAAkB,eAAEwB,SAAS,SAAUC,GAAMzB,EAAI0B,eAAeD,GAAKE,WAAW,qBAAqB,MAAM,GAAGvB,EAAG,QAAQ,CAACE,MAAM,CAAC,GAAK,QAAQ,IAAI,IAC/iCsB,EAAkB,G,qECuDtB,GAEEC,KAAM,SAENC,KAJF,WAMI,MAAO,CACLJ,eAAgB,GAGhBP,SAAS,EACTN,cAAe,OACfN,QAAQ,IAKZ,QAjBF,WAiBA,wJAEA,0BAFA,8CAMEwB,QAAS,CAEPV,sBAAuB,WAA3B,uJAGA,4CAHA,wBAKA,iEAGA,gBAYA,+BApBA,SAqBA,2BACA,2BACA,mBACA,qBAxBA,UAqBA,EArBA,OA2BA,eA3BA,wBA4BA,iBA5BA,2BAiCA,8BAEA,qBAnCA,sGAA2B,GAyCvBW,cAAe,WAAnB,WAGM/B,KAAKkB,SAAU,EAGflB,KAAKY,cAAgB,QAGrBoB,YAAW,WACT,EAAR,UAEQC,EAAR,2CAGQD,YAAW,WACT,EAAV,2BACA,QAEA,SC7IgV,I,YCO5UE,EAAY,eACd,EACApC,EACA6B,GACA,EACA,KACA,WACA,MAIa,aAAAO,E","file":"js/chunk-2d0d0286.00ced11c.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('b-row',[_c('b-col',{attrs:{\"md\":\"2\"}}),_c('b-col',{attrs:{\"md\":\"8\"}},[_c('b-jumbotron',{attrs:{\"bg-variant\":_vm.locked ? 'info' : 'success',\"text-variant\":\"light\"},scopedSlots:_vm._u([{key:\"header\",fn:function(){return [_c('div',{staticClass:\"text-center\"},[(_vm.locked)?_c('b-icon',{staticClass:\"border border-light rounded p-2\",attrs:{\"icon\":\"lock\",\"animation\":_vm.iconAnimation,\"font-scale\":\"2\"}}):_c('b-icon',{staticClass:\"border border-light rounded p-2\",attrs:{\"icon\":\"unlock\",\"font-scale\":\"2\"}})],1)]},proxy:true},{key:\"lead\",fn:function(){return [_c('strong',[_vm._v(\" Shuumulator-WEB | \")]),_vm._v(\" \"+_vm._s(_vm.$t('signin'))+\" \")]},proxy:true}])},[_c('p',[_c('b-form-input',{ref:\"focusThis\",attrs:{\"disabled\":_vm.loading,\"autocomplete\":\"off\",\"size\":\"lg\"},on:{\"input\":_vm.inspectInvitationCode},model:{value:(_vm.invitationCode),callback:function ($$v) {_vm.invitationCode=$$v},expression:\"invitationCode\"}})],1)])],1),_c('b-col',{attrs:{\"md\":\"2\"}})],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <div>\n    <b-row>\n      <b-col md=\"2\" />\n      <b-col md=\"8\">\n        <b-jumbotron\n          :bg-variant=\"locked ? 'info' : 'success'\"\n          text-variant=\"light\"\n        >\n          <template #header>\n            <div class=\"text-center\">\n              <b-icon\n                v-if=\"locked\"\n                icon=\"lock\"\n                class=\"border border-light rounded p-2\"\n                :animation=\"iconAnimation\"\n                font-scale=\"2\"\n              />\n              <b-icon\n                v-else\n                icon=\"unlock\"\n                class=\"border border-light rounded p-2\"\n                font-scale=\"2\"\n              />\n            </div>\n          </template>\n\n          <template #lead>\n            <strong>\n              Shuumulator-WEB |\n            </strong>\n            {{ $t('signin') }}\n          </template>\n\n          <p>\n            <b-form-input\n              ref=\"focusThis\"\n              v-model=\"invitationCode\"\n              :disabled=\"loading\"\n              autocomplete=\"off\"\n              size=\"lg\"\n              @input=\"inspectInvitationCode\"\n            />\n          </p>\n        </b-jumbotron>\n      </b-col>\n      <b-col md=\"2\" />\n    </b-row>\n  </div>\n</template>\n\n<script>\nimport axiosUtils from '@/utils/axiosUtils';\nimport Cookies from 'js-cookie';\nimport pnotifyUtils from '@/utils/pnotifyUtils';\n\nexport default {\n\n  name: 'SignIn',\n\n  data() {\n\n    return {\n      invitationCode: '',\n\n      // 演出のための data です。\n      loading: false,\n      iconAnimation: 'fade',\n      locked: true,\n    };\n\n  },\n\n  async mounted () {\n\n    this.$refs.focusThis.focus();\n\n  },\n\n  methods: {\n\n    inspectInvitationCode: async function () {\n\n      // コードには everybody-dance-now を認めている。\n      if (this.invitationCode === 'everybody-dance-now') {\n\n        pnotifyUtils.popHidingNotice('Invitation code accepted. Verifying...');\n\n        // Disable input.\n        this.loading = true;\n\n        // ロックアイコンをアニメートしたあと遷移します。\n\n        // これを再現したいんだけど -d の部分がどうしても Django へ渡らない……。\n        // curl -X POST -d \"code=everybody-dance-now\" http://localhost:8000/api-token-auth/\n        // Django に json で post しても受け付けてくれない。\n        // ↓\n        // application/x-www-form-urlencoded でおくんないとだめだったか。\n        // axios で application/x-www-form-urlencoded を送るときは URLSearchParams を使わないとだめ。\n        // ↓\n        // 渡らない理由は Django 側で json post を受け付けなかったからだった。\n        const axiosInstance = axiosUtils.createAxiosInstance();\n        const response = await axiosInstance.post(`/api-token-auth/`, {\n          code: this.invitationCode,\n        }).catch(err => {\n          return err.response;\n        });\n        // NOTE: CORS でひっかかると response が undefined。\n        if (response.status !== 200) {\n          console.error(response);\n          return;\n        }\n        // サインインに成功すると {token: jwt token} が返ってきます。\n        // Cookie に保存する。\n        Cookies.set('token', response.data.token);\n\n        this.animateUnlock();\n\n      }\n\n    },\n\n    animateUnlock: function () {\n\n      // Disable input.\n      this.loading = true;\n\n      // ロック状態のアイコンを揺らす。\n      this.iconAnimation = 'cylon';\n\n      // ロック -> アンロックアイコンにチェンジ。\n      setTimeout(() => {\n        this.locked = false;\n\n        pnotifyUtils.popHidingSuccess('SignIn succeeded.');\n\n        // アンロックアイコンを見せたあと、遷移します。\n        setTimeout(() => {\n          this.$router.push({ path: '/' });\n        }, 1500);\n\n      }, 1500);\n\n    },\n\n  },\n\n}\n</script>\n\n<style scoped>\n</style>\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./SignIn.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./SignIn.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./SignIn.vue?vue&type=template&id=f89c4e2c&scoped=true&\"\nimport script from \"./SignIn.vue?vue&type=script&lang=js&\"\nexport * from \"./SignIn.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"f89c4e2c\",\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}